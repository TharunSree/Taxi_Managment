{% extends "vertical.html" %}
{% load static %}

{% block title %}{{title}}{% endblock title %}

{% block extra_css %}
<style>
    .star-rating {
        display: inline-block;
        font-size: 0; /* Remove spacing between stars */
    }

    .star {
        display: inline-block;
        width: 40px;
        height: 40px;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ddd"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>') no-repeat center;
        background-size: contain;
        cursor: pointer;
        transition: all 0.2s ease;
        margin-right: 5px;
    }

    .star.active, .star:hover {
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffc107"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>');
    }

    .star-rating:hover .star {
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ddd"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>');
    }

    .star-rating:hover .star:hover,
    .star-rating:hover .star:hover ~ .star {
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffc107"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>');
    }

    .rating-text {
        margin-left: 10px;
        font-weight: 500;
        color: #666;
    }
</style>
{% endblock extra_css %}

{% block page_content %}
    {% include "partials/page-title.html" with title="Trips" subtitle=title %}

    <div class="row">
        <div class="col-xl-9">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Submit Rating for Trip #{{ trip.id }}</h4>
                    <p class="text-muted mb-0"><strong>Vendor:</strong> {{ trip.vehicle.vendor.name }} | <strong>Vehicle:</strong> {{ trip.vehicle }}</p>
                </div>
                <div class="card-body">
                    <form method="post" novalidate>
                        {% csrf_token %}

                        <div class="mb-3">
                            <label class="form-label d-block">Stars</label>
                            <div class="star-rating" id="star-rating">
                                <span class="star" data-rating="1"></span>
                                <span class="star" data-rating="2"></span>
                                <span class="star" data-rating="3"></span>
                                <span class="star" data-rating="4"></span>
                                <span class="star" data-rating="5"></span>
                            </div>
                            <span class="rating-text" id="rating-text">Click to rate</span>
                            {{ form.stars }}
                            {% if form.stars.errors %}
                                <div class="invalid-feedback d-block">{{ form.stars.errors.as_text }}</div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.comment.label_tag }}
                            {{ form.comment }}
                            {% if form.comment.errors %}
                                <div class="invalid-feedback d-block">{{ form.comment.errors.as_text }}</div>
                            {% endif %}
                        </div>

                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary">Submit Rating</button>
                            <a href="{% url 'trip_list' %}" class="btn btn-light">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock page_content %}

{% block extra_javascript %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const stars = document.querySelectorAll('.star');
    const ratingInput = document.getElementById('id_stars');
    const ratingText = document.getElementById('rating-text');
    let currentRating = 0;

    const ratingTexts = {
        1: "Poor",
        2: "Fair",
        3: "Good",
        4: "Very Good",
        5: "Excellent"
    };

    // Initialize with existing value if any
    if (ratingInput.value) {
        currentRating = parseInt(ratingInput.value);
        setRating(currentRating);
    }

    stars.forEach(star => {
        star.addEventListener('click', function() {
            const rating = parseInt(this.dataset.rating);
            currentRating = rating;
            setRating(rating);
            ratingInput.value = rating;
            ratingText.textContent = ratingTexts[rating];
        });

        star.addEventListener('mouseenter', function() {
            const rating = parseInt(this.dataset.rating);
            highlightStars(rating);
            ratingText.textContent = ratingTexts[rating];
        });
    });

    document.getElementById('star-rating').addEventListener('mouseleave', function() {
        setRating(currentRating);
        ratingText.textContent = currentRating > 0 ? ratingTexts[currentRating] : "Click to rate";
    });

    function setRating(rating) {
        stars.forEach((star, index) => {
            if (index < rating) {
                star.classList.add('active');
            } else {
                star.classList.remove('active');
            }
        });
    }

    function highlightStars(rating) {
        stars.forEach((star, index) => {
            if (index < rating) {
                star.style.backgroundImage = "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"%23ffc107\"><path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"/></svg>')";
            } else {
                star.style.backgroundImage = "url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"%23ddd\"><path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"/></svg>')";
            }
        });
    }
});
</script>
{% endblock extra_javascript %}