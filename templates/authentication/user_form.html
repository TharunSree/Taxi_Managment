{% extends "vertical.html" %}

{% block title %}{{title}}{% endblock title %}

{% block page_content %}
    {% include "partials/page-title.html" with title="User Management" subtitle=title %}
    <div class="row">
        <div class="col-xl-9">
            <div class="card">
                <div class="card-body">
                    <form method="post" novalidate>
                        {% csrf_token %}

                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                {% for error in form.non_field_errors %}
                                    <p class="mb-0">{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}

                        {{ form.username.label_tag }}
                        {{ form.username }}
                        <div class="mb-3"></div>
                        {{ form.first_name.label_tag }}
                        {{ form.first_name }}
                        <div class="mb-3"></div>
                        {{ form.email.label_tag }}
                        {{ form.email }}
                        <div class="mb-3"></div>

                        <div class="mb-3">
                            {{ form.password1.label_tag }}
                            {{ form.password1 }}
                            <div id="password-validation-hints" class="mt-2">
                                <small id="length" class="d-block text-muted"><i class="ri-close-circle-line me-1"></i> At least 8 characters long</small>
                                <small id="lowercase" class="d-block text-muted"><i class="ri-close-circle-line me-1"></i> Contains a lowercase letter</small>
                                <small id="uppercase" class="d-block text-muted"><i class="ri-close-circle-line me-1"></i> Contains an uppercase letter</small>
                                <small id="number" class="d-block text-muted"><i class="ri-close-circle-line me-1"></i> Contains a number</small>
                            </div>
                            {% if form.password1.errors %}
                                <div class="invalid-feedback d-block">{{ form.password1.errors.as_text }}</div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.password2.label_tag }}
                            {{ form.password2 }}
                            {% if form.password2.errors %}
                                <div class="invalid-feedback d-block">{{ form.password2.errors.as_text }}</div>
                            {% endif %}
                        </div>

                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary">Create User</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock page_content %}

{% block extra_javascript %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('id_password1');
    const lengthHint = document.getElementById('length');
    const lowercaseHint = document.getElementById('lowercase');
    const uppercaseHint = document.getElementById('uppercase');
    const numberHint = document.getElementById('number');

    const validatePassword = () => {
        const password = passwordInput.value;

        // Helper function to update hint style
        const updateHint = (element, isValid) => {
            if (isValid) {
                element.classList.remove('text-muted');
                element.classList.add('text-success');
                element.querySelector('i').className = 'ri-check-line me-1';
            } else {
                element.classList.remove('text-success');
                element.classList.add('text-muted');
                element.querySelector('i').className = 'ri-close-circle-line me-1';
            }
        };

        // Check each criterion
        updateHint(lengthHint, password.length >= 8);
        updateHint(lowercaseHint, /[a-z]/.test(password));
        updateHint(uppercaseHint, /[A-Z]/.test(password));
        updateHint(numberHint, /[0-9]/.test(password));
    };

    passwordInput.addEventListener('input', validatePassword);
});
</script>
{% endblock extra_javascript %}